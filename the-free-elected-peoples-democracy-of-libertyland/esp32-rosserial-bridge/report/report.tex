%% Lab Report for EEET2493_labreport_template.tex
%% V1.0
%% 2019/01/16
%% This is the template for a Lab report following an IEEE paper. Modified by Francisco Tovar after Michael Sheel original document.


%% This is a skeleton file demonstrating the use of IEEEtran.cls
%% (requires IEEEtran.cls version 1.8b or later) with an IEEE
%% journal paper.
%%
%% Support sites:
%% http://www.michaelshell.org/tex/ieeetran/
%% http://www.ctan.org/pkg/ieeetran
%% and
%% http://www.ieee.org/

%%*************************************************************************
%% Legal Notice:
%% This code is offered as-is without any warranty either expressed or
%% implied; without even the implied warranty of MERCHANTABILITY or
%% FITNESS FOR A PARTICULAR PURPOSE! 
%% User assumes all risk.
%% In no event shall the IEEE or any contributor to this code be liable for
%% any damages or losses, including, but not limited to, incidental,
%% consequential, or any other damages, resulting from the use or misuse
%% of any information contained here.
%%
%% All comments are the opinions of their respective authors and are not
%% necessarily endorsed by the IEEE.
%%
%% This work is distributed under the LaTeX Project Public License (LPPL)
%% ( http://www.latex-project.org/ ) version 1.3, and may be freely used,
%% distributed and modified. A copy of the LPPL, version 1.3, is included
%% in the base LaTeX documentation of all distributions of LaTeX released
%% 2003/12/01 or later.
%% Retain all contribution notices and credits.
%% ** Modified files should be clearly indicated as such, including  **
%% ** renaming them and changing author support contact information. **
%%*************************************************************************

\documentclass[journal]{IEEEtran}

% *** CITATION PACKAGES ***
\usepackage[style=ieee]{biblatex} 

% *** MATH PACKAGES ***
\usepackage{amsmath}

% *** PDF, URL AND HYPERLINK PACKAGES ***
\usepackage{url}
% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}
\usepackage{graphicx}  %needed to include png, eps figures
\usepackage{float}  % used to fix location of images i.e.\begin{figure}[H]

%https://tex.stackexchange.com/questions/230828/when-referencing-a-figure-make-text-and-figure-name-clickable
\usepackage[colorlinks]{hyperref}

\usepackage{pdflscape}
\usepackage{multicol}
\usepackage{listings}
\usepackage{color}
\usepackage[dvipsnames]{xcolor}

%https://tex.stackexchange.com/questions/245842/i-am-trying-to-get-the-image-full-screen-and-landscape
\usepackage{graphicx}
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{lscape}
\usepackage{rotating}
\usepackage{pdflscape}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
language=C++,
aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3,
  %https://stackoverflow.com/questions/3915709/latex-lstlisting-automatically-recognizing-code-passage
  rangeprefix=//-LaTeX:,
  rangesuffix=;,
  includerangemarker=false,
  columns=spaceflexible,
  %https://tex.stackexchange.com/questions/106770/how-to-add-line-numbers-to-a-program-listing-code
  % numbers=left,
  stepnumber=1
}

\lstdefinelanguage{Ini}
{
    basicstyle=\ttfamily\small,
    columns=fullflexible,
    morecomment=[s][\color{mauve}\bfseries]{[}{]},
    morecomment=[l]{\#},
    morecomment=[l]{;},
    commentstyle=\color{gray}\ttfamily,
    morekeywords={},
    otherkeywords={=,:},
    keywordstyle={\color{green}\bfseries}
}

% https://github.com/GothenburgBitFactory/guides/blob/master/20151107_de_openrheinruhr/yaml_syntax_highlighting.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% YAML syntax highlighting %%%%%%%%%%%%%%%%%

% http://tex.stackexchange.com/questions/152829/how-can-i-highlight-yaml-code-in-a-pretty-way-with-listings

% here is a macro expanding to the name of the language
% (handy if you decide to change it further down the road)
\newcommand\YAMLcolonstyle{\color{red}\mdseries}
\newcommand\YAMLkeystyle{\color{black}\bfseries}
\newcommand\YAMLvaluestyle{\color{blue}\mdseries}

\makeatletter

\newcommand\language@yaml{yaml}

\expandafter\expandafter\expandafter\lstdefinelanguage
\expandafter{\language@yaml}
{
  keywords={true,false,null,y,n},
  keywordstyle=\color{darkgray}\bfseries,
  basicstyle=\YAMLkeystyle,                                 % assuming a key comes first
  sensitive=false,
  comment=[l]{\#},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{purple}\ttfamily,
  stringstyle=\YAMLvaluestyle\ttfamily,
  moredelim=[l][\color{orange}]{\&},
  moredelim=[l][\color{magenta}]{*},
  moredelim=**[il][\YAMLcolonstyle{:}\YAMLvaluestyle]{:},   % switch to value style at :
  morestring=[b]',
  morestring=[b]",
  literate =    {---}{{\ProcessThreeDashes}}3
                {>}{{\textcolor{red}\textgreater}}1     
                {|}{{\textcolor{red}\textbar}}1 
                {\ -\ }{{\mdseries\ -\ }}3,
}

% switch to key style at EOL
\lst@AddToHook{EveryLine}{\ifx\lst@language\language@yaml\YAMLkeystyle\fi}
\makeatother

\newcommand\ProcessThreeDashes{\llap{\color{cyan}\mdseries-{-}-}}

%%%%%%%%%%% YAML syntax highlighting %%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

% paper title
\title{Arduino Lab 4}

% author names 
\author{Knut Ola NÃ¸sen
}% <-this % stops a space

% The report headers
\markboth{IELET1002 DATATEKNIKK. LAB. REPORT 4, MARCH 2022}%do not delete next lines
{Shell \MakeLowercase{\textit{et al.}}: Bare Demo of IEEEtran.cls for IEEE Journals}

% make the title area
\maketitle

% As a general rule, do not put math, special symbols or citations
% in the abstract or keywords.
\begin{abstract}
    The project explores the mechanics of line-following as well as
    task scheduling without a proper threading system.
\end{abstract}

\begin{IEEEkeywords}
    Arduino, LED, RAMP, Sequential, Multithreading, Zumo, PID, Regulator
\end{IEEEkeywords}

\section{Theory}
% Here we have the typical use of a "W" for an initial drop letter
% and "RITE" in caps to complete the first word.
% You must have at least 2 lines in the paragraph with the drop letter
% (should never be an issue)

\IEEEPARstart{T}{he}
the Zumo platform contains a suite of sensors and actuators.
In this project, we mostly focus on the light-sensors used To
detect guide-lines below the robot, the bi-directional motors
driving the belts of the Zumo, as well as the lcd display attached
to the top of the board.


\subsection{Software}
Lets start by creating some configs to keep our code free of "magic constants".
By keeping these configs in separate files, we avoid cluttering our logic in the main.cpp file.\\


\lstinputlisting[language=C++, caption=Range.h]{../lib/Range/Range.h}

\vfill\null
\pagebreak

\lstinputlisting[language=C++, caption=PidControllerConfig.h]{../lib/PidController/PidControllerConfig.h}

\onecolumn

\lstinputlisting[language=C++, caption=ApplicationConfig.h]{../lib/ApplicationConfig/ApplicationConfig.h}
This gives us a global const appConfig when we include the ApplicationConfig.h file
in our main sketch.

\vfill\null
\pagebreak

\lstinputlisting[language=C++, caption=Timer.h]{../lib/Timer/Timer.h}
We also create a Timer class to make time tracking a bit easier and more intuitive.

\vfill\null
\pagebreak

\lstinputlisting[language=C++, caption=Scaling.h]{../lib/Scaling/Scaling.h}
This project calls for much manipulation of IO-Ranges. We create an own
file to keep this reusable and well-documented. We also copy the implementation
of map\(\) from Arduino.h, to make such fundemendal tasks less platform-dependent.

\vfill\null
\pagebreak

\lstinputlisting[language=C++, firstline=3, lastline=65, caption=PidController.h]{../lib/PidController/PidController.h}
To abstract the complex inner workings of the PidController we
create an own class to encapsulate this logic.

\vfill\null
\pagebreak

Finally for our last external file we create a state-machine to
handle task scheduling for our sequential code.
\lstinputlisting[language=C++, caption=Sequence.h]{../lib/Sequence/Sequence.h}

\vfill\null
\pagebreak

Now that all our external files are set up, we can start looking at the main.cpp file.
%https://stackoverflow.com/questions/3915709/latex-lstlisting-automatically-recognizing-code-passage
\lstinputlisting[language=C++, caption=main.cpp]{../src/main.cpp}

\vfill\null
\pagebreak

\section{Discussion}
In the previous two labs, my discussion contained the following:\\

The current code works excellently, however it does have a weakness.
While the nested nature of this code makes for very few instances of "state" and
globals, it does prevent us from running continous updates on anything while
a piece of code is executing. In a larger project, i believe it would be
beneficial to avoid while and for-loops, in favour of a more flat architecture with
state machines. That way, the project remains scalable, and we can easily add
continous checks without risking spagheti code and human errors due to forgetting
to call an updater during a special loop.\\

Here, we have finally addressed this problem by writing
the Scaling.h library. This is reusable and should cover our needs
for the forseable future in regards to getting rid of state-machines.

\end{document}


